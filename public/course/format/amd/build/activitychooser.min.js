define("core_courseformat/activitychooser",["exports","core_courseformat/local/activitychooser/dialogue","core/custom_interaction_events","core/log","core/pending","core_courseformat/local/activitychooser/repository","core_courseformat/local/activitychooser/selectors"],(function(_exports,ChooserDialogue,_custom_interaction_events,_log,_pending,Repository,_selectors){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * A type of dialogue used as for choosing modules in a course.
   *
   * @module     core_courseformat/activitychooser
   * @copyright  2020 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,ChooserDialogue=_interopRequireWildcard(ChooserDialogue),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_log=_interopRequireDefault(_log),_pending=_interopRequireDefault(_pending),Repository=_interopRequireWildcard(Repository),_selectors=_interopRequireDefault(_selectors);let initialized=!1;_exports.init=function(courseId){let chooserConfig=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const pendingPromise=new _pending.default;void 0!==(null==chooserConfig?void 0:chooserConfig.tabmode)&&window.console.warn("The tabmode config option has been deprecated and will be ignored."),registerListenerEvents(courseId),pendingPromise.resolve()};const registerListenerEvents=courseId=>{if(initialized)return;initialized=!0;const eventsToHandle=["click",_custom_interaction_events.default.events.activate,_custom_interaction_events.default.events.keyboardActivate];_custom_interaction_events.default.define(document,eventsToHandle),eventsToHandle.forEach((eventToHandle=>{document.addEventListener(eventToHandle,(async event=>{if(!event.target.closest(_selectors.default.elements.sectionmodchooser))return;const position=function(target){var _ref,_caller$dataset$secti,_caller$dataset,_caller$dataset2,_caller$dataset$secti2,_caller$dataset3,_caller$dataset$befor,_caller$dataset4;let caller,sectionNum=null,sectionId=null;const sectionDiv=target.closest(_selectors.default.elements.section),button=target.closest(_selectors.default.elements.sectionmodchooser);null!==sectionDiv&&(sectionDiv.hasAttribute("data-number")||sectionDiv.hasAttribute("data-id"))?(caller=sectionDiv,sectionNum=sectionDiv.getAttribute("data-number"),sectionId=sectionDiv.getAttribute("data-id")):(caller=button,caller.hasAttribute("data-sectionid")&&(window.console.warn("The data-sectionid attribute has been deprecated. Please update your code to use data-section-id passing the real section ID instead."),caller.setAttribute("data-sectionnum",caller.dataset.sectionid)),sectionNum=caller.dataset.sectionnum,sectionId=caller.getAttribute("data-section-id"));return{sectionNum:sectionNum,sectionId:sectionId,sectionReturnNum:null!==(_ref=null!==(_caller$dataset$secti=null===(_caller$dataset=caller.dataset)||void 0===_caller$dataset?void 0:_caller$dataset.sectionreturnnum)&&void 0!==_caller$dataset$secti?_caller$dataset$secti:null===(_caller$dataset2=caller.dataset)||void 0===_caller$dataset2?void 0:_caller$dataset2.sectionreturn)&&void 0!==_ref?_ref:null,sectionReturnId:null!==(_caller$dataset$secti2=null===(_caller$dataset3=caller.dataset)||void 0===_caller$dataset3?void 0:_caller$dataset3.sectionreturnid)&&void 0!==_caller$dataset$secti2?_caller$dataset$secti2:null,beforeMod:null!==(_caller$dataset$befor=null===(_caller$dataset4=caller.dataset)||void 0===_caller$dataset4?void 0:_caller$dataset4.beforemod)&&void 0!==_caller$dataset$befor?_caller$dataset$befor:null}}(event.target),footerDataPromise=Repository.getModalFooterData(courseId,position.sectionNum);let modulesDataPromise;position.sectionId&&""!==position.sectionId?modulesDataPromise=Repository.getSectionModulesData(courseId,position.sectionId,position.sectionReturnNum,position.beforeMod):(_log.default.debug("Having only the section number attribute in the activity chooser is deprecated. Please add the data-section-id attribute."),modulesDataPromise=Repository.getModulesData(courseId,position.sectionNum,position.sectionReturnNum,position.beforeMod)),ChooserDialogue.displayActivityChooserModal(footerDataPromise,modulesDataPromise)}))}))}}));

//# sourceMappingURL=activitychooser.min.js.map