{"version":3,"file":"dialoguedom.min.js","sources":["../../../src/local/activitychooser/dialoguedom.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {addIconToContainer} from 'core/loadingicon';\nimport Carousel from 'theme_boost/bootstrap/carousel';\nimport {getFirst} from 'core/normalise';\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport selectors from 'core_courseformat/local/activitychooser/selectors';\nimport Tab from 'theme_boost/bootstrap/tab';\nimport * as Templates from 'core/templates';\n\n\n/**\n * The activity changer dialogue DOM manipulation module.\n *\n * @module     core_courseformat/local/activitychooser/dialoguedom\n * @copyright  2025 Ferran Recio <ferran@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nexport default class ChooserDialogueDOM {\n    /**\n     * ChooserDialogueDOM constructor.\n     *\n     * @param {Object} dialogue The dialogue object.\n     * @param {Modal} modal The modal object.\n     * @param {Object} exporter The exporter object to generate template data.\n     */\n    constructor(dialogue, modal, exporter) {\n        this.modal = modal;\n        this.modalBody = getFirst(this.modal.getBody());\n        this.exporter = exporter;\n        // Temporal variable while migrating methods.\n        this.dialogue = dialogue;\n    }\n\n    /**\n     * Get the search input element.\n     *\n     * @return {HTMLElement} The search input element.\n     */\n    getSearchInputElement() {\n        return this.modalBody.querySelector(selectors.actions.search);\n    }\n\n    /**\n     * Get the closest chooser option element.\n     *\n     * @param {HTMLElement} element\n     * @return {HTMLElement|null} element\n     */\n    getClosestChooserOption(element) {\n        return element.closest(selectors.regions.chooserOption.container);\n    }\n\n    /**\n     * Check if the search tab is active.\n     *\n     * @return {Boolean} True if the search tab is active, false otherwise.\n     */\n    isFavoutiteTabActive() {\n        const favouriteTab = this.modalBody.querySelector(selectors.regions.favouriteTabNav);\n        return favouriteTab && favouriteTab.classList.contains('active');\n    }\n\n    /**\n     * Get the URL of a chooser option.\n     *\n     * @param {HTMLElement} optionContainer The container of the chooser option.\n     * @return {String} The URL of the chooser option.\n     * @throws {Error} If the option container does not contain a link.\n     */\n    getChooserOptionUrl(optionContainer) {\n        const optionLink = optionContainer.querySelector(selectors.actions.addChooser);\n        if (!optionLink) {\n            throw new Error('Invalid chooser option container: no link found');\n        }\n        return optionLink.getAttribute('href');\n    }\n\n    /**\n     * Show the search results.\n     *\n     * @param {String} searchQuery The search query string.\n     * @param {Object} searchResultsData Data containing the module items that satisfy the search criteria\n     */\n    async refreshSearchResults(searchQuery, searchResultsData) {\n        const searchResultsContainer = this.modalBody.querySelector(selectors.regions.searchResults);\n        const clearSearchButton = this.modalBody.querySelector(selectors.actions.clearSearch);\n\n        await this.renderSearchResults(searchResultsContainer, searchQuery, searchResultsData);\n        const chooserOptionsContainer = searchResultsContainer.querySelector(selectors.regions.chooserOptions);\n        const firstSearchResultItem = chooserOptionsContainer.querySelector(selectors.regions.chooserOption.container);\n        if (firstSearchResultItem) {\n            // Set the first result item to be focusable.\n            this.toggleFocusableChooserOption(firstSearchResultItem, true);\n            // Register keyboard events on the created search result items.\n        }\n        clearSearchButton.classList.remove('d-none');\n\n        // Results are rendered in the all activities tab, so we need to hide the category content.\n        const tabContent = searchResultsContainer.closest(selectors.regions.tabContent);\n        const categoryContent = tabContent.querySelector(selectors.regions.categoryContent);\n        categoryContent.classList.add('d-none');\n    }\n\n    /**\n     * Clear the search results.\n     */\n    cleanSearchResults() {\n        const searchResultsContainer = this.modalBody.querySelector(selectors.regions.searchResults);\n        const clearSearchButton = this.modalBody.querySelector(selectors.actions.clearSearch);\n        searchResultsContainer.innerHTML = '';\n        clearSearchButton.classList.add('d-none');\n\n        // Results are rendered in the all activities tab, so we need to show the category content again.\n        const tabContent = searchResultsContainer.closest(selectors.regions.tabContent);\n        const categoryContent = tabContent.querySelector(selectors.regions.categoryContent);\n        categoryContent.classList.remove('d-none');\n    }\n\n    /**\n     * Render the search results in a defined container\n     *\n     * @private\n     * @method renderSearchResults\n     * @param {HTMLElement} searchResultsContainer The container where the data should be rendered\n     * @param {String} searchQuery The search query string\n     * @param {Object} searchResultsData Data containing the module items that satisfy the search criteria\n     */\n    async renderSearchResults(searchResultsContainer, searchQuery, searchResultsData) {\n        const templateData = this.exporter.getSearchResultData(searchQuery, searchResultsData);\n        // Build up the html & js ready to place into the help section.\n        const {html, js} = await Templates.renderForPromise(\n            'core_courseformat/local/activitychooser/search_results',\n            templateData\n        );\n        await Templates.replaceNodeContents(searchResultsContainer, html, js);\n    }\n\n    /**\n     * Show the \"All activities\" tab.\n     *\n     * @method showAllActivitiesTab\n     * @return {HTMLElement} The \"All activities\" tab element.\n     */\n    showAllActivitiesTab() {\n        return this.showCategoryTab('all');\n    }\n\n    /**\n     * Show a specific category tab.\n     * @method showCategoryTab\n     * @param {String} category The category to show.\n     * @return {HTMLElement} The category tab element.\n     */\n    showCategoryTab(category) {\n        const navTab = this.modalBody.querySelector(selectors.regions.categoryTabNav(category));\n\n        if (navTab.classList.contains('active')) {\n            return navTab;\n        }\n\n        const pendingPromise = new Pending(`core_courseformat/activitychooser:${category}-tab`);\n\n        navTab.addEventListener('shown.bs.tab', pendingPromise.resolve, {once: true});\n        Tab.getOrCreateInstance(navTab).show();\n\n        return navTab;\n    }\n\n    /**\n     * Update the starred icons in the chooser modal.\n     *\n     * @method updateItemStarredIcons\n     * @param {String} internal The internal name of the module.\n     * @param {Boolean} favourite Whether the module is a favourite or not.\n     */\n    updateItemStarredIcons(internal, favourite) {\n        const favouriteButtons = this.modalBody.querySelectorAll(\n            `${selectors.elements.moduleItem(internal)} ${selectors.actions.optionActions.manageFavourite}`\n        );\n        Array.from(favouriteButtons).forEach((element) => {\n            element.dataset.favourited = favourite;\n            element.setAttribute('aria-pressed', favourite);\n            element.querySelector(selectors.elements.favouriteIconActive)?.classList.toggle('d-none', !favourite);\n            element.querySelector(selectors.elements.favouriteIconInactive)?.classList.toggle('d-none', favourite);\n\n            const iconSelectsor = favourite ? selectors.elements.favouriteIconActive : selectors.elements.favouriteIconInactive;\n            const favouriteIcon = element.querySelector(iconSelectsor);\n            element.setAttribute('aria-label', favouriteIcon?.getAttribute('data-action-label') || '');\n            element.setAttribute('title', favouriteIcon?.getAttribute('data-action-label') || '');\n        });\n    }\n\n    /**\n     * Refresh the favourite content.\n     *\n     * @param {Array} mappedModules The modules to be displayed in the favourite tab.\n     */\n    async refreshFavouritesTabContent(mappedModules) {\n        const templateData = await this.exporter.getFavouriteTabData(mappedModules);\n        const favouriteArea = this.modalBody.querySelector(selectors.regions.favouriteTab);\n        const {html, js} = await Templates.renderForPromise(\n            'core_courseformat/local/activitychooser/tabcontent',\n            templateData,\n        );\n        await Templates.replaceNodeContents(favouriteArea, html, js);\n    }\n\n    /**\n     * Toggle the display of the favourite tab.\n     *\n     * The favourite tab is only displayed when there are favourite modules\n     * or when it is the active tab.\n     *\n     * @param {Boolean} displayed Whether we want to show or hide the favourite tab\n     */\n    toggleFavouriteTabDisplay(displayed) {\n        const favouriteTabNav = this.modalBody.querySelector(selectors.regions.favouriteTabNav);\n\n        let moveFocusTo;\n        if (!displayed && favouriteTabNav.classList.contains('active')) {\n            moveFocusTo = this.showAllActivitiesTab();\n        }\n\n        favouriteTabNav?.classList.toggle('d-none', !displayed);\n        favouriteTabNav.tabIndex = displayed ? 0 : -1;\n        // The disabled class is used by Boostrap Tab for keyboard navigation.\n        if (displayed) {\n            favouriteTabNav.classList.remove('disabled');\n        } else {\n            favouriteTabNav.classList.add('disabled');\n        }\n\n        if (moveFocusTo) {\n            moveFocusTo.focus();\n        }\n        this.initActiveTabNavigation();\n    }\n\n    /**\n     * Given an event from the main module 'page' navigate to it's help section via a carousel.\n     *\n     * @method showModuleHelp\n     * @param {Object} moduleData Data of the module to carousel to\n     */\n    async showModuleHelp(moduleData) {\n        const carousel = this.modalBody.querySelector(selectors.regions.carousel);\n\n        const help = carousel.querySelector(selectors.regions.help);\n        help.innerHTML = '';\n        help.classList.add('m-auto');\n\n        // Add a spinner.\n        const spinnerPromise = addIconToContainer(help);\n\n        // Used later...\n        let transitionPromiseResolver = null;\n        const transitionPromise = new Promise(resolve => {\n            transitionPromiseResolver = resolve;\n        });\n\n        // Build up the html & js ready to place into the help section.\n        const contentPromise = Templates.renderForPromise(\n            'core_courseformat/local/activitychooser/help',\n            await this.exporter.getModuleHelpTemplateData(moduleData),\n        );\n\n        // Wait for the content to be ready, and for the transition to be complet.\n        Promise.all([contentPromise, spinnerPromise, transitionPromise])\n            .then(([{html, js}]) => Templates.replaceNodeContents(help, html, js))\n            .then(() => {\n                help.querySelector(selectors.regions.chooserSummary.header).focus();\n                return help;\n            })\n            .catch(Notification.exception);\n\n        // Move to the next slide, and resolve the transition promise when it's done.\n        carousel.addEventListener(\n            'slid.bs.carousel',\n            () => {\n                transitionPromiseResolver();\n            },\n            {once: true}\n        );\n        // Trigger the transition between 'pages'.\n        Carousel.getInstance(carousel).next();\n    }\n\n    /**\n     * Hide the help section of the chooser.\n     *\n     * @param {String|null} internal The internal name of the module to return to, if any.\n     */\n    hideModuleHelp(internal = null) {\n        const carousel = this.modalBody.querySelector(selectors.regions.carousel);\n        // Trigger the transition between 'pages'.\n        Carousel.getInstance(carousel).to(0);\n        // Some active footers may not provide a valid internal value.\n        if (!internal) {\n            return;\n        }\n        carousel.addEventListener(\n            'slid.bs.carousel',\n            () => {\n                this.focusChooserOption(internal);\n            },\n            {once: true}\n        );\n    }\n\n    /**\n     * Set the module data for the back button.\n     *\n     * @param {Object} moduleData The module data to set for the back button.\n     */\n    setBackButtonModuleData(moduleData) {\n        const footer = getFirst(this.modal.getFooter());\n        const modnameValue = `${moduleData.componentname}_${moduleData.link}`;\n        footer.querySelector(selectors.actions.closeOption).dataset.modname = modnameValue;\n    }\n\n    /**\n     * Toggle the visibility of the back button.\n     *\n     * @param {Boolean} show Whether to show or hide the back button.\n     */\n    toggleBackButton(show) {\n        const footer = getFirst(this.modal.getFooter());\n        footer.querySelector(selectors.actions.closeOption).classList.toggle('d-none', !show);\n    }\n\n    /**\n     * Toggle the visibility of the \"Add selected\" button.\n     *\n     * @param {Boolean} show Whether to show or hide the \"Add selected\" button.\n     */\n    toggleAddButton(show) {\n        const footer = getFirst(this.modal.getFooter());\n        footer.querySelector(selectors.actions.addSelectedChooserOption).classList.toggle('d-none', !show);\n    }\n\n    /**\n     * Toggle the visibility of the active footer.\n     *\n     * @param {Boolean} show Whether to show or hide the active footer.\n     */\n    toggleActiveFooter(show) {\n        const footer = getFirst(this.modal.getFooter());\n        footer.querySelector(selectors.regions.activeFooter).classList.toggle('d-none', !show);\n    }\n\n    /**\n     * Focus on a specific activity inside the active tab (if present).\n     *\n     * @private\n     * @method focusChooserOption\n     * @param {String} internal The internal name of the module.\n     */\n    focusChooserOption(internal) {\n        const currentTabNav = this.modalBody.querySelector(selectors.elements.activetab);\n        const activeSectionId = currentTabNav.getAttribute(\"href\");\n        const sectionChooserOptions = this.modalBody.querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\n        const newCurrent = sectionChooserOptions.querySelector(selectors.regions.getModuleSelector(internal));\n\n        if (!newCurrent) {\n            throw new Error(`Invalid chooser option to focus on: ${internal}`);\n        }\n\n        // Chooser can only have one element focusable at a time, so we disable them all first.\n        this.disableFocusAllChooserOptions(currentTabNav);\n        this.toggleFocusableChooserOption(newCurrent, true);\n\n        // Little hack: we want the element considered a focus-visible element.\n        // But the focus method does not trigger the focus-visible class. There's an\n        // experimental \"{focusVisible: true}\" option in the focus method, but it's not\n        // supported in all browsers yet so we need to fake an editable element.\n        newCurrent.contentEditable = true;\n        newCurrent.focus();\n        newCurrent.contentEditable = false;\n    }\n\n    /**\n     * Initialise the active tab navigation.\n     */\n    initActiveTabNavigation() {\n        const activeSectionId = this.modalBody.querySelector(selectors.elements.activetab).getAttribute(\"href\");\n        const sectionChooserOptions = this.modalBody.querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\n        const firstChooserOption = sectionChooserOptions?.querySelector(selectors.regions.chooserOption.container);\n        if (!firstChooserOption) {\n            return;\n        }\n        this.toggleFocusableChooserOption(firstChooserOption, true);\n    }\n\n    /**\n     * Initialise all Boostrap components.\n     */\n    initBootstrapComponents() {\n        this.modalBody.querySelectorAll(selectors.elements.tab).forEach((navTab) => {\n            // Init the Bootstrap Tab navigation.\n            Tab.getOrCreateInstance(navTab);\n        });\n\n        // Set up the carousel.\n        const carousel = this.modalBody.querySelector(selectors.regions.carousel);\n        new Carousel(carousel, {\n            interval: false,\n            pause: true,\n            keyboard: false\n        });\n    }\n\n    /**\n     * Disable the focus of all chooser options in a specific container (section).\n     *\n     * @method disableFocusAllChooserOptions\n     * @param {HTMLElement} tabNav The tab navigation element (from the shown.bs.ta event).\n     */\n    disableFocusAllChooserOptions(tabNav) {\n        const tabId = tabNav.getAttribute(\"href\");\n        const chooserOptions = this.modalBody.querySelector(\n            selectors.regions.getSectionChooserOptions(tabId)\n        );\n\n        if (chooserOptions === null) {\n            return;\n        }\n\n        const allChooserOptions = chooserOptions.querySelectorAll(selectors.regions.chooserOption.container);\n        allChooserOptions.forEach((chooserOption) => {\n            this.toggleFocusableChooserOption(chooserOption, false);\n        });\n    }\n\n    /**\n     * Add or remove a chooser option from the focus order.\n     *\n     * @private\n     * @method toggleFocusableChooserOption\n     * @param {HTMLElement} chooserOption The chooser option element which should be added or removed from the focus order\n     * @param {Boolean} isFocusable Whether the chooser element is focusable or not\n     */\n    toggleFocusableChooserOption(chooserOption, isFocusable) {\n        const chooserOptionLink = chooserOption.querySelector(selectors.actions.addChooser);\n        const chooserOptionHelp = chooserOption.querySelector(selectors.actions.optionActions.showSummary);\n        const chooserOptionFavourite = chooserOption.querySelector(selectors.actions.optionActions.manageFavourite);\n\n        if (isFocusable) {\n            // Set tabindex to 0 to add current chooser option element to the focus order.\n            chooserOption.tabIndex = 0;\n            chooserOptionLink.tabIndex = 0;\n            chooserOptionHelp.tabIndex = 0;\n            chooserOptionFavourite.tabIndex = 0;\n        } else {\n            // Set tabindex to -1 to remove the previous chooser option element from the focus order.\n            chooserOption.tabIndex = -1;\n            chooserOptionLink.tabIndex = -1;\n            chooserOptionHelp.tabIndex = -1;\n            chooserOptionFavourite.tabIndex = -1;\n        }\n    }\n\n    /**\n     * Move the focus to the previous chooser option element.\n     *\n     * @param {HTMLElement} current The current chooser option element\n     */\n    focusNextChooserOption(current) {\n        this.moveChooserOptionFocus(\n            current,\n            (currentOption) => currentOption.nextElementSibling ?? currentOption,\n        );\n    }\n\n    /**\n     * Move the focus to the previous chooser option element.\n     *\n     * @param {HTMLElement} current The current chooser option element\n     */\n    focusPreviousChooserOption(current) {\n        this.moveChooserOptionFocus(\n            current,\n            (currentOption) => currentOption.previousElementSibling ?? currentOption,\n        );\n    }\n\n    /**\n     * Move the focus to the first chooser option element.\n     *\n     * @param {HTMLElement} current The current chooser option element\n     */\n    focusFirstChooserOption(current) {\n        this.moveChooserOptionFocus(\n            current,\n            (currentOption, container) => container.firstElementChild ?? currentOption,\n        );\n    }\n\n    /**\n     * Move the focus to the last chooser option element.\n     *\n     * @param {HTMLElement} current The current chooser option element\n     */\n    focusLastChooserOption(current) {\n        this.moveChooserOptionFocus(\n            current,\n            (currentOption, container) => container.lastElementChild ?? currentOption,\n        );\n    }\n\n    /**\n     * Move the focus to the next chooser option element.\n     *\n     * @private\n     * @param {HTMLElement} current The current chooser option element\n     * @param {Function} getNextFocus Function to get the next focusable element\n     */\n    moveChooserOptionFocus(current, getNextFocus) {\n        const currentOption = this.getClosestChooserOption(current);\n        const container = current.closest(selectors.regions.chooserOptions);\n\n        if (!container || !currentOption) {\n            throw new Error('Invalid chooser options container or current option');\n        }\n\n        const newFocusOption = getNextFocus(currentOption, container);\n        if (!newFocusOption) {\n            return;\n        }\n\n        this.toggleFocusableChooserOption(currentOption, false);\n        this.toggleFocusableChooserOption(newFocusOption, true);\n        newFocusOption.focus();\n    }\n\n    /**\n     * Mark a chooser option as selected.\n     *\n     * @param {HTMLElement} chooserOption The chooser option element to mark as selected.\n     */\n    markChooserOptionAsSelected(chooserOption) {\n        this.unmarkAllChooserOptionAsSelected();\n        chooserOption.classList.add('selected');\n        chooserOption.setAttribute('aria-selected', 'true');\n\n        const footer = getFirst(this.modal.getFooter());\n        const addButton = footer.querySelector(selectors.actions.addSelectedChooserOption);\n        if (addButton) {\n            addButton.removeAttribute('disabled');\n        }\n    }\n\n    /**\n     * Unmark all chooser options as selected.\n     */\n    unmarkAllChooserOptionAsSelected() {\n        const selectedOptions = this.modalBody.querySelectorAll(`${selectors.regions.chooserOption.container}.selected`);\n        selectedOptions.forEach((option) => {\n            option.classList.remove('selected');\n            option.setAttribute('aria-selected', 'false');\n        });\n\n        const footer = getFirst(this.modal.getFooter());\n        const addButton = footer.querySelector(selectors.actions.addSelectedChooserOption);\n        if (addButton) {\n            addButton.setAttribute('disabled', 'disabled');\n        }\n    }\n}\n"],"names":["constructor","dialogue","modal","exporter","modalBody","this","getBody","getSearchInputElement","querySelector","selectors","actions","search","getClosestChooserOption","element","closest","regions","chooserOption","container","isFavoutiteTabActive","favouriteTab","favouriteTabNav","classList","contains","getChooserOptionUrl","optionContainer","optionLink","addChooser","Error","getAttribute","searchQuery","searchResultsData","searchResultsContainer","searchResults","clearSearchButton","clearSearch","renderSearchResults","firstSearchResultItem","chooserOptions","toggleFocusableChooserOption","remove","tabContent","categoryContent","add","cleanSearchResults","innerHTML","templateData","getSearchResultData","html","js","Templates","renderForPromise","replaceNodeContents","showAllActivitiesTab","showCategoryTab","category","navTab","categoryTabNav","pendingPromise","Pending","addEventListener","resolve","once","getOrCreateInstance","show","updateItemStarredIcons","internal","favourite","favouriteButtons","querySelectorAll","elements","moduleItem","optionActions","manageFavourite","Array","from","forEach","dataset","favourited","setAttribute","favouriteIconActive","toggle","favouriteIconInactive","iconSelectsor","favouriteIcon","mappedModules","getFavouriteTabData","favouriteArea","toggleFavouriteTabDisplay","displayed","moveFocusTo","tabIndex","focus","initActiveTabNavigation","moduleData","carousel","help","spinnerPromise","transitionPromiseResolver","transitionPromise","Promise","contentPromise","getModuleHelpTemplateData","all","then","_ref","chooserSummary","header","catch","Notification","exception","getInstance","next","hideModuleHelp","to","focusChooserOption","setBackButtonModuleData","footer","getFooter","modnameValue","componentname","link","closeOption","modname","toggleBackButton","toggleAddButton","addSelectedChooserOption","toggleActiveFooter","activeFooter","currentTabNav","activetab","activeSectionId","newCurrent","getSectionChooserOptions","getModuleSelector","disableFocusAllChooserOptions","contentEditable","sectionChooserOptions","firstChooserOption","initBootstrapComponents","tab","Carousel","interval","pause","keyboard","tabNav","tabId","isFocusable","chooserOptionLink","chooserOptionHelp","showSummary","chooserOptionFavourite","focusNextChooserOption","current","moveChooserOptionFocus","currentOption","nextElementSibling","focusPreviousChooserOption","previousElementSibling","focusFirstChooserOption","firstElementChild","focusLastChooserOption","lastElementChild","getNextFocus","newFocusOption","markChooserOptionAsSelected","unmarkAllChooserOptionAsSelected","addButton","removeAttribute","option"],"mappings":"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"}