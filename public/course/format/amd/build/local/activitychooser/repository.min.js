define("core_courseformat/local/activitychooser/repository",["exports","core/ajax","core/log"],(function(_exports,_ajax,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * A javascript module to handle user AJAX actions.
   *
   * @module     core_courseformat/local/activitychooser/repository
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fetchFooterData=_exports.favouriteModule=_exports.activityModules=void 0,_exports.getModalFooterData=async function(courseId,sectionNum){const cacheKey="".concat(courseId,"-").concat(sectionNum);if(sectionsFooterPromises.has(cacheKey))return sectionsFooterPromises.get(cacheKey);return sectionsFooterPromises.set(cacheKey,new Promise((resolve=>{resolve(fetchFooterData(courseId,sectionNum))}))),sectionsFooterPromises.get(cacheKey)},_exports.getModulesData=async function(courseId,sectionNum,sectionReturnNum,beforeMod){_log.default.debug("The getModulesData function is deprecated. Use getSectionModulesData instead.");const cacheKey="".concat(courseId,"-").concat(sectionNum);sectionsModulesPromises.has(cacheKey)||sectionsModulesPromises.set(cacheKey,new Promise((resolve=>{resolve(activityModules(courseId,sectionNum))})));const moduleData=await sectionsModulesPromises.get(cacheKey);if(!moduleData)throw new Error("Cannot fetch module data");return sectionMapper(moduleData,null,sectionReturnNum,beforeMod,sectionNum)},_exports.getSectionModulesData=async function(courseId,sectionId,sectionReturnNum,beforeMod){const cacheKey="".concat(courseId,"-").concat(sectionId);sectionsModulesPromises.has(cacheKey)||sectionsModulesPromises.set(cacheKey,new Promise((resolve=>{resolve(sectionActivityModules(courseId,sectionId))})));const moduleData=await sectionsModulesPromises.get(cacheKey);if(!moduleData)throw new Error("Cannot fetch module data");return sectionMapper(moduleData,sectionId,sectionReturnNum,beforeMod)},_exports.unfavouriteModule=_exports.sectionActivityModules=void 0,_ajax=_interopRequireDefault(_ajax),_log=_interopRequireDefault(_log);const sectionsModulesPromises=new Map,sectionsFooterPromises=new Map,activityModules=(courseid,sectionnum)=>{_log.default.debug("The activityModules function is deprecated. Use sectionActivityModules instead.");const request={methodname:"core_course_get_course_content_items",args:{courseid:courseid,sectionnum:sectionnum}};return _ajax.default.call([request])[0]};_exports.activityModules=activityModules;const sectionActivityModules=(courseId,sectionId)=>{const request={methodname:"core_courseformat_get_section_content_items",args:{courseid:courseId,sectionid:sectionId}};return _ajax.default.call([request])[0]};_exports.sectionActivityModules=sectionActivityModules;_exports.favouriteModule=(modName,modID)=>{const request={methodname:"core_course_add_content_item_to_user_favourites",args:{componentname:modName,contentitemid:modID}};return _ajax.default.call([request])[0].then((()=>(sectionsModulesPromises.clear(),!0)))};_exports.unfavouriteModule=(modName,modID)=>{const request={methodname:"core_course_remove_content_item_from_user_favourites",args:{componentname:modName,contentitemid:modID}};return _ajax.default.call([request])[0].then((()=>(sectionsModulesPromises.clear(),!0)))};const fetchFooterData=(courseid,sectionid)=>{const request={methodname:"core_course_get_activity_chooser_footer",args:{courseid:courseid,sectionid:sectionid}};return _ajax.default.call([request])[0]};function sectionMapper(webServiceData,sectionId,sectionReturnNum,beforeMod){let legacySectionNum=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const newData=JSON.parse(JSON.stringify(webServiceData));let urlParams="&beforemod="+(null!=beforeMod?beforeMod:0);return sectionId&&(urlParams+="&sectionid=".concat(sectionId)),legacySectionNum&&(urlParams+="&section=".concat(legacySectionNum)),sectionReturnNum&&(urlParams+="&sr=".concat(sectionReturnNum)),newData.content_items.forEach((module=>{module.link+=urlParams})),newData.content_items}_exports.fetchFooterData=fetchFooterData}));

//# sourceMappingURL=repository.min.js.map