<?xml version="1.0" encoding="UTF-8"?>
<XMLDB PATH="local/computerservice/db" VERSION="2025071701"
       COMMENT="XMLDB file for computerservice plugin – linked to local_status">

    <TABLES>

        <!-- ──────────────────────────────────────────────────────────────── -->
        <!--  Device-request table                                           -->
        <!-- ──────────────────────────────────────────────────────────────── -->
        <TABLE NAME="local_computerservice_requests"
               COMMENT="Stores device requests from teachers and managers">

            <FIELDS>
                <FIELD NAME="id"               TYPE="int"  LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="userid"           TYPE="int"  LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="courseid"         TYPE="int"  LENGTH="10" NOTNULL="true"/>

                <!-- Devices requested – foreign key to devices table -->
                <!-- Foreign key to local_computerservice_devices table -->
                <FIELD NAME="deviceid" TYPE="int" LENGTH="10" NOTNULL="true"/>

                <!-- FK → local_status -->
                <FIELD NAME="status_id"        TYPE="int"  LENGTH="10" NOTNULL="true"/>

                <FIELD NAME="numdevices"       TYPE="int"  LENGTH="5"  NOTNULL="true"/>
                <FIELD NAME="timecreated"      TYPE="int"  LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="timemodified"     TYPE="int"  LENGTH="10" NOTNULL="false" DEFAULT="0"/>
                <FIELD NAME="request_needed_by" TYPE="int"  LENGTH="10" NOTNULL="true"  DEFAULT="0"/>
                <FIELD NAME="comments"         TYPE="text"               NOTNULL="false"/>
                <FIELD NAME="rejection_note"   TYPE="text"               NOTNULL="false"/>
                <FIELD NAME="approval_note"    TYPE="text"               NOTNULL="false"/>
                <FIELD NAME="is_urgent"     TYPE="int"  LENGTH="1"  NOTNULL="true"  DEFAULT="0"/>
            </FIELDS>

            <KEYS>
                <KEY NAME="primary"     TYPE="primary" FIELDS="id"/>
                <KEY NAME="userid_fk"   TYPE="foreign" FIELDS="userid"    REFTABLE="user"         REFFIELDS="id"/>
                <KEY NAME="courseid_fk" TYPE="foreign" FIELDS="courseid"  REFTABLE="course"       REFFIELDS="id"/>
                <KEY NAME="status_fk"   TYPE="foreign" FIELDS="status_id" REFTABLE="local_status" REFFIELDS="id"/>
                <KEY NAME="deviceid_fk"  TYPE="foreign" FIELDS="deviceid" REFTABLE="local_computerservice_devices" REFFIELDS="id"/>
            </KEYS>
        </TABLE>

        <!-- ──────────────────────────────────────────────────────────────── -->
        <!--  Device master table                                            -->
        <!-- ──────────────────────────────────────────────────────────────── -->
        <TABLE NAME="local_computerservice_devices"
               COMMENT="Stores available device types">

            <FIELDS>
                <FIELD NAME="id"            TYPE="int"  LENGTH="10" NOTNULL="true" SEQUENCE="true"/>

                <!-- Bilingual device names -->
                <FIELD NAME="devicename_en" TYPE="char" LENGTH="100" NOTNULL="true"/>
                <FIELD NAME="devicename_ar" TYPE="char" LENGTH="100" NOTNULL="true"/>

                <FIELD NAME="status"        TYPE="char" LENGTH="10"  NOTNULL="true" DEFAULT="active"
                       COMMENT="Device availability status"/>
            </FIELDS>

            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
            </KEYS>
        </TABLE>

    </TABLES>
</XMLDB>
